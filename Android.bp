// This file is generated by cargo2android.py --device --run --copy-out --min-sdk-version 31 --onefile.
// Do not modify this file as changes will be overridden on upgrade.



genrule {
    name: "copy_mmtk_build_out",
    srcs: ["out/*"],
    cmd: "cp $(in) $(genDir)",
    out: ["built.rs"],
}

rust_library {
    name: "libmmtk",
    host_supported: true,
    crate_name: "mmtk",
    cargo_env_compat: true,
    cargo_pkg_version: "0.22.1",
    srcs: [
        "src/lib.rs",
        ":copy_mmtk_build_out",
    ],
    edition: "2021",
    features: [
        "default",
        "vm_space",
        "sticky_immix_non_moving_nursery",
        "immix_zero_on_release", // debug only
        // "perf_counter",
    ],
    // "debug" build
    flags: [
        "-C opt-level=0",
        "-C debuginfo=2",
        "-C strip=none",
        "-C debug-assertions=true",
        "-C overflow-checks=true",
        "-C codegen-units=256",
    ],
    // "release" build
    // flags: [
    //     "-C opt-level=3",
    //     "-C debuginfo=0",
    //     "-C strip=symbols",
    //     "-C debug-assertions=false",
    //     "-C overflow-checks=false",
    //     "-C codegen-units=16",
    // ],
    rustlibs: [
        "libatomic_rust",
        "libatomic_refcell",
        "libatomic_traits",
        "libbytemuck",
        "libcfg_if",
        "libcrossbeam_deque",
        "libcrossbeam_queue",
        "libdowncast_rs",
        "libenum_map",
        "libenv_logger",
        "libitertools",
        "liblazy_static",
        "liblibc",
        "liblog_rust",
        "libmemoffset",
        "libnum_cpus",
        "libnum_traits",
        // "libpfm",
        "libportable_atomic",
        "libprobe",
        "libregex",
        "libspin",
        "libstatic_assertions",
        "libstrum",
        "libsysinfo",
    ],
    proc_macros: [
        "libdelegate",
        "libmmtk_macros",
        "libstrum_macros",
    ],
    apex_available: [
        "//apex_available:platform",
        "//apex_available:anyapex",
    ],
    product_available: true,
    vendor_available: true,
    min_sdk_version: "31",
}

rust_proc_macro {
    name: "libmmtk_macros",
    crate_name: "mmtk_macros",
    cargo_env_compat: true,
    cargo_pkg_version: "0.20.0",
    srcs: [
        "macros/src/lib.rs",
        ":copy_mmtk_build_out",
    ],
    edition: "2021",
    rustlibs: [
        "libproc_macro2",
        "libproc_macro_error",
        "libquote",
        "libsyn",
    ],
    product_available: true,
    vendor_available: true,
}
